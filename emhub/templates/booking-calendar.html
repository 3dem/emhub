

<div class="container-fluid  dashboard-content">
    <!-- Header -->
    {% set title = "Booking Calendar" %}
    {% include 'include_header.html' %}

    <!-- ============================================================== -->
    <!-- events calendar -->
    <!-- ============================================================== -->
    <div class="row">
        <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
            <div class="card">
                <div class="card-body">
                    <div class='row'>
                       <div class="col-2">

                           <div id="booking-type">
                            {% for r in resources %}
                               <div class="row justify-content-start" style="margin-top: 10px;">

                                   <div class="col-auto text-left mr-0 pr-0">
                                       <label class="custom-control custom-checkbox" style="margin-left: 5px;">
                                            <input type="checkbox" checked="" class="custom-control-input"  data-resource-id="{{ r['id'] }}" onclick="filterBookingsByResource(this)"><span class="custom-control-label"></span>
                                        </label>
                                   </div>
                                   <div class="col-auto text-left  ml-0 pl-0">
                                       <h4 style="float: left"> {{ r['name'] }}</h4>
                                   </div>

                                   <div class="col text-right">
                                       <div style="background-color: {{ r['color'] }}; width: 30px; height: 30px; float: right; margin-right: 10px"> &nbsp;</div>
                                   </div>
<!--                                   <div class="col-4 text-right"  style="margin: 2px">-->

<!--                                       <div class="switch-button switch-button-xs" >-->
<!--                                           <input type="checkbox" checked="" name="switch{{r['id']}}" id="switch{{r['id']}}">-->
<!--                                           <span><label for="switch{{r['id']}}"></label></span>-->
<!--                                        </div>-->


<!--                                   </div>-->
                               </div>

                                <div class="row align-top" style="margin: -15px 0 0 25px">
                                    <label class="custom-control custom-radio custom-control-inline">
                                        <input type="radio" name="radio-inline" class="custom-control-input"><span class="custom-control-label">Book</span>
                                    </label>
                                    {% if current_user.is_manager %}
                                    <label class="custom-control custom-radio custom-control-inline is-invalid">
                                        <input type="radio" name="radio-inline" class="custom-control-input"><span class="custom-control-label">Downtime</span>
                                    </label>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>

                       </div>
                        <div class="col-9">
                        <div id='booking-calendar'></div>
                    </div>
                        <div style='clear:both'></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ============================================================== -->
    <!-- end events calendar -->
    <!-- ============================================================== -->
    </div>


<!-- Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="exampleModalLongTitle">Delete Resource</h3>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary">Delete</button>
      </div>
    </div>
  </div>
</div>


<!-- javascript  -->
<script>
    var events;
    var calendar;

(function(window, document, $, undefined) {
    "use strict";

    /* Function to show the modal */
    function showBooking(startStr, endStr) {
      $('#deleteModal').find('.modal-body').html('<p> Do you want add Booking from ' + startStr + ' to ' + endStr + '</p>')
      $('#deleteModal').modal('show')
    }

   /* initialize the external events
  -----------------------------------------------------------------*/

    var Calendar = FullCalendar.Calendar;
    var Draggable = FullCalendarInteraction.Draggable;

    var containerEl = document.getElementById('booking-type');
    var calendarEl = document.getElementById('booking-calendar');

    // initialize the external events
    // -----------------------------------------------------------------

    var userName = "{{current_user.name}}";

    new Draggable(containerEl, {
      itemSelector: '.fc-event',
      eventData: function(eventEl) {
          // var propValue;
          //   for(var propName in eventEl) {
          //       propValue = eventEl[propName]
          //
          //       console.log(propName, '->', propValue);
          //   }
          var suffix;
          if (eventEl.innerText == 'Downtime')
              suffix = 'Downtime';
          else
              suffix = userName;

          console.log('id: ', eventEl.dataset['rid'])

        return {
          title: eventEl.dataset['rname'] + '(' + suffix + ')',
          textColor: 'white',
          color: eventEl.dataset["color"],
          extendedProps: {resource_id: eventEl.dataset['rid']}
            //duration: {days: 2}
        };
      }
    });

    var bookings = {{ bookings|tojson }} ;


    calendar = new Calendar(calendarEl, {
        plugins: [ 'interaction', 'dayGrid', 'timeGrid' ],
        header: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        editable: true,
        droppable: true, // this allows things to be dropped onto the calendar
        selectable: true, // allows to select dates
        // drop: function(info) {
        //   // is the "remove after drop" checkbox checked?
        //   if (checkbox.checked) {
        //     // if so, remove the element from the "Draggable Events" list
        //     info.draggedEl.parentNode.removeChild(info.draggedEl);
        //   }
        // }
        events: bookings,
        eventReceive: function(info) {
            //info.event.setProp('title', 'Booking of ' + userName)
       },
        eventAllow: function(dropInfo, draggedEvent) {
            var resource_id = draggedEvent.extendedProps['resource_id'];

            if (resource_id == 1) {
            //return dropInfo.start < new Date(2016, 0, 1); // a boolean
              return false;
            }
            else {
               return true;
            }
        },
        selectAllow: function(info) {
            return true;
        },
        // dateClick: function(info) {
        //     alert('clicked ' + info.dateStr);
        // },
        select: function(info) {
            showBooking(info.startStr, info.endStr);
        }
  });

  events = calendar.getEvents();
  calendar.render();

})(window, document, window.jQuery);


function filterBookingsByResource(input) {
    inputId = input.dataset.resourceId;
    // console.log("filtering by id: ", inputId);
    // console.log("        checked: ", input.checked);

    for (var event of events) {
        // console.log("Event: ", event.title);
        // console.log("   resource:", event.extendedProps.resource_id);

        if (event.extendedProps.resource_id == inputId){
            if (input.checked)
                calendar.addEvent(event);
            else
                event.remove();
        }
    }
}

</script>