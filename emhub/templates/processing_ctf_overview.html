{% macro row_plot_label(sel_id, title, selectedValue) -%}
    <div class="row col-12 mt-2">
        <h4 class="col-4 col-form-label text-right">{{ title }}</h4>
        <select id="{{ sel_id }}" class="selectpicker col-7" style="width: 100%" onchange="highlightButton()">
            {% for s in data_values %}
                {% set selected = 'selected' if s == selectedValue else '' %}
                <option value="{{ s }}" {{ selected }}>{{ s }} </option>
            {% endfor %}
        </select>
    </div>
{%- endmacro %}

<div class="row col-12">
    <div class="col-3 row">

        <div class="col-12 row align-content-start">
            {{ row_plot_label('plot-labelX-select', 'X Label', 'index') }}
            {{ row_plot_label('plot-labelY-select', 'Y Label', 'rlnCtfMaxResolution') }}
            {{ row_plot_label('plot-labelColor-select', 'Color Label') }}
            <div class="row col-12 mt-3">
                <div class="col-4"></div>
                <div class="col-7 align-content-end">
                    <a href="javascript:makePlot()" class="btn btn-dark float-right" id="update-plots-btn"> Update Plots</a>
                </div>

            </div>
        </div>


    </div>

    <div id='myDiv' class="col-8" style="height: 700px; width: 1400px;">
        <!-- Plotly chart will be drawn inside this DIV -->
    </div>


</div>

<script>
    var data_values = {{ data_values|tojson }};

    function highlightButton(){
        //$('#update-plots-btn').toggleClass('btn-outline-dark btn-dark');
    }

    function makePlot(){
        //$('#update-plots-btn').toggleClass('btn-dark btn-outline-dark');

        let label_x = $('#plot-labelX-select').selectpicker('val');
        let data_x = data_values[label_x].data;

        let label_y = $('#plot-labelY-select').selectpicker('val');
        let data_y = data_values[label_y].data;

        let label_color = $('#plot-labelColor-select').selectpicker('val');
        let data_color = data_values[label_color].data;

        var data = [
            {'fillcolor': 'white',
                  'marker': {'color': data_color,
                             'colorscale': [[0.0, '#440154'], [0.1111111111111111,
                                            '#482878'], [0.2222222222222222,
                                            '#3e4989'], [0.3333333333333333,
                                            '#31688e'], [0.4444444444444444,
                                            '#26828e'], [0.5555555555555556,
                                            '#1f9e89'], [0.6666666666666666,
                                            '#35b779'], [0.7777777777777778,
                                            '#6ece58'], [0.8888888888888888,
                                            '#b5de2b'], [1.0, '#fde725']],
                             'opacity': 0.5,
                             'showscale': true},
                  'mode': 'markers',
                  'type': 'scattergl',
                  'x': data_x,
                  'y': data_y },
             {'marker': {'color': 'cornflowerblue', 'opacity': 0.5},
              'name': label_x,
              'type': 'violin',
              'x': data_x,
              'yaxis': 'y2'},
             {'marker': {'color': 'cornflowerblue', 'opacity': 0.5},
              'name': label_y,
              'type': 'violin',
              'xaxis': 'x2',
              'y': data_y}
        ];

        var layout = {'bargap': 0,
           'hovermode': 'closest',
           'margin': {'t': 50},
           'plot_bgcolor': 'rgba(0,0,0,0)',
           'showlegend': false,
           'template': '...',
           'xaxis': {'domain': [0, 0.85], 'gridcolor': '#CBCBCB', 'title': {'text': label_x}, 'zeroline': true},
           'xaxis2': {'domain': [0.85, 1], 'showgrid': true, 'zeroline': false},
           'yaxis': {'domain': [0, 0.85],
                     'gridcolor': '#CBCBCB',
                     'title': {'text': label_y},
                     'zeroline': true},
           'yaxis2': {'domain': [0.85, 1], 'showgrid': true, 'zeroline': false}};

        Plotly.newPlot('myDiv', data, layout);

    }




    (function(window, document, $, undefined) {
    "use strict";
    $(function() {

        $('.selectpicker').selectpicker();

        makePlot();
});
})(window, document, window.jQuery);
</script>